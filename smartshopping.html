<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NFC Inventory & Ordering System</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
  h1 { text-align: center; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
  th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
  th { background-color: #f4f4f4; }
  button { padding: 6px 12px; cursor: pointer; }
  #message { margin-bottom: 20px; color: green; font-weight: bold; }
</style>
</head>
<body>

<h1>NFC Inventory & Ordering System</h1>

<div id="message"></div>

<h2>Available Items</h2>
<table id="inventoryTable">
  <thead>
    <tr>
      <th>Item Name</th>
      <th>Stock</th>
      <th>Price (THB)</th>
      <th>Order Quantity</th>
      <th>Order</th>
    </tr>
  </thead>
  <tbody>
    <!-- Items will load here -->
  </tbody>
</table>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbzm4FnYd_EeEljlgUKZ4R1sZJdd2kOKWMwHLz1BZURxToJ0yJ2ZfSI7jRun-bZw2etxgg/exec';

async function fetchInventory() {
  try {
    const response = await fetch(`${API_URL}?action=getInventory`);
    const items = await response.json();
    populateTable(items);
  } catch (error) {
    console.error('Error fetching inventory:', error);
  }
}

function populateTable(items) {
  const tbody = document.querySelector("#inventoryTable tbody");
  tbody.innerHTML = "";
  items.forEach(item => {
    let tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${item.ItemName}</td>
      <td id="stock-${item.ItemName}">${item.Stock}</td>
      <td>${item.Price}</td>
      <td><input type="number" id="qty-${item.ItemName}" min="1" max="${item.Stock}" value="1" style="width:60px" /></td>
      <td><button onclick="submitOrder('${item.ItemName}')">Order</button></td>
    `;
    tbody.appendChild(tr);
  });
}

async function submitOrder(itemName) {
  const qtyInput = document.getElementById(`qty-${itemName}`);
  const quantity = parseInt(qtyInput.value);
  const stockElem = document.getElementById(`stock-${itemName}`);
  const currentStock = parseInt(stockElem.textContent);

  if (quantity <= 0 || quantity > currentStock) {
    alert("Invalid quantity");
    return;
  }

  const orderData = {
    itemName: itemName,
    quantity: quantity
  };

  try {
    const response = await fetch(`${API_URL}?action=submitOrder`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(orderData)
    });
    const text = await response.text();
    if (text === "Order successful") {
      document.getElementById("message").textContent = `Order placed for ${quant
