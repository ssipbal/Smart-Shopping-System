<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NFC Inventory & Ordering System</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 10px; }
  h1, h2 { text-align: center; }
  #productInfo { margin-top: 20px; padding: 15px; border: 1px solid #ddd; display: none; }
  label { display: block; margin-top: 10px; }
  input[type=number] { width: 80px; padding: 5px; }
  button { margin-top: 15px; padding: 8px 16px; font-size: 16px; cursor: pointer; }
  #message { margin-top: 15px; font-weight: bold; }
</style>
</head>
<body>

<h1>NFC Inventory & Ordering System</h1>

<button id="scanBtn">Scan NFC Tag</button>

<div id="message"></div>

<div id="productInfo">
  <h2>Product Details</h2>
  <p><strong>Name:</strong> <span id="prodName"></span></p>
  <p><strong>Stock:</strong> <span id="prodStock"></span></p>
  <p><strong>Price:</strong> à¸¿<span id="prodPrice"></span></p>

  <label for="orderQty">Order Quantity:</label>
  <input type="number" id="orderQty" min="1" value="1" />

  <button id="orderBtn">Place Order</button>
</div>

<script>
  const API_URL = 'https://script.google.com/macros/s/AKfycbx3Fr8GIbYWjdwfH-TlLqLsAKLGxuUOeWIHiXNUod-j4LDPxrCElViBxyX7lrr1hfv8pQ/exec';

  let inventory = [];
  let currentProduct = null;

  // Fetch inventory from backend
  async function fetchInventory() {
    try {
      const response = await fetch(`${API_URL}?action=getInventory`);
      inventory = await response.json();
      console.log("Inventory loaded:", inventory);
    } catch (err) {
      alert("Failed to load inventory: " + err.message);
    }
  }

  // Scan NFC Tag
  async function scanNfcTag() {
    if ('NDEFReader' in window) {
      try {
        const ndef = new NDEFReader();
        await ndef.scan();
        document.getElementById('message').textContent = 'Scan NFC tag now...';

        ndef.onreading = event => {
          const serial = event.serialNumber.toUpperCase();
          document.getElementById('message').textContent = 'NFC Tag scanned: ' + serial;
          onNfcTagRead(serial);
        };
      } catch (error) {
        alert('NFC scan failed: ' + error);
      }
    } else {
      alert('Web NFC not supported on this browser.');
    }
  }

  // Called when an NFC tag serial is read
  function onNfcTagRead(serialNumber) {
    // Find product in inventory by NFC_ID (ignore case and colons)
    const cleanSerial = serialNumber.replace(/:/g, '').toUpperCase();

    currentProduct = inventory.find(item => {
      if (!item.NFC_ID) return false;
      let itemId = item.NFC_ID.replace(/:/g, '').toUpperCase();
      return itemId === cleanSerial;
    });

    if (currentProduct) {
      showProduct(currentProduct);
    } else {
      alert("Product not found for NFC tag: " + serialNumber);
      hideProduct();
    }
  }

  // Show product info and order controls
  function showProduct(product) {
    document.getElementById('productInfo').style.display = 'block';
    document.getElementById('prodName').textContent = product.ItemName;
    document.getElementById('prodStock').textContent = product.Sto
